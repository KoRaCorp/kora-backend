buildscript {
    ext {
        restdocsApiSpecVersion = '0.17.1'
    }
}

plugins {
    /**
     * Reference Swagger & Restdocs Integration
     * https://thalals.tistory.com/433
     */
    id "com.epages.restdocs-api-spec" version "${restdocsApiSpecVersion}"
    // swagger generator í”Œë¡œê·¸ì¸ ì¶”ê°€
    id 'org.hidetake.swagger.generator' version '2.18.2'
}
configurations {
    asciidoctorExt // asciidoctor extensionì— ëŒ€í•œ ì„¤ì •ì„ ë„£ì–´ì¤€ë‹¤.
}

repositories {
    mavenCentral()
}

bootJar { // bootJar ì„¸íŒ…ì„ ì¼œê¸°
    enabled = true
}

jar { // jar ì„¤ì •ì€ ë„ê¸°
    enabled = false
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    implementation 'org.springframework.boot:spring-boot-starter-validation'


    // Todo @Trasactional ì‚¬ìš© ëª©ì  -> ë” ê°€ë²¼ìš´ ì˜ì¡´ì„± ì¶”ê°€ ê°€ëŠ¥í•œì§€ í™•ì¸ í•„ìš”
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'

    // swagger ë„ìš°ê¸°
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2'

    /**
     * Rest Docs
     */


    // swagger - rest docs ì—°ê²°
    testImplementation 'org.springframework.restdocs:spring-restdocs-mockmvc'
    testImplementation "com.epages:restdocs-api-spec-mockmvc:${restdocsApiSpecVersion}"
}

tasks.withType(GenerateSwaggerUI) {
    dependsOn 'openapi3'
    delete file('src/main/resources/static/docs/')
    copy {
        from "build/resources/main/static/docs"
        into "src/main/resources/static/docs/"
    }
}

bootJar {
    dependsOn('openapi3')
}

openapi3 {
    servers = [
            {
                url = "http://localhost:8080"
                description = "Local Server"
            }

    ]
    title = "kora.corp api docs"
    description = "### ğŸ’¡ ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­!\n" +
            "1. loginì„ ì‹œë„í•˜ê³  accessTokenì„ ë°”ë¡œ ë°‘ ì˜¤ë¥¸ìª½ í•˜ë‹¨ `Authorize` ë²„íŠ¼ì„ í´ë¦­í•´ì„œ Bearerë¥¼ ì œì™¸í•œ accessTokenì„ ë°”ë¡œ ë„£ì–´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\n" +
            "2. apiì™€ admin-apiì˜ êµ¬ë¶„ì„ ìœ„í•´ì„œ `api`ì— ğŸ“Œ prefixë¥¼ ë‹¬ì•„ ë‘ì—ˆìŠµë‹ˆë‹¤."
    version = "0.1.0"
    format = "json"
    outputFileNamePrefix = 'open-api-3.0.1'

    // /static/docs/open-api-3.0.1.json ìƒì„±
    outputDirectory = "build/resources/main/static/docs"

}

tasks.named('test') {
    useJUnitPlatform()
}

/**
 * ë¹Œë“œ ì •ë³´ actuatorì— ì¶”ê°€
 * META_INF/build-info.propertiesê°€ ìƒì„±ë¨
 */

springBoot {
    buildInfo()
}
